<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nuestra Constelaci√≥n ‚ú®</title>
  <style>
    :root{
      --bg1:#070914;
      --bg2:#12092a;
      --card: rgba(255,255,255,.08);
      --card2: rgba(255,255,255,.12);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.68);
      --border: rgba(255,255,255,.18);
      --accent: #ff6fb7;
      --accent2:#7dd3ff;
      --shadow: 0 18px 50px rgba(0,0,0,.45);
      --radius: 18px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      overflow:hidden;
      background:
        radial-gradient(1200px 800px at 20% 10%, rgba(255,111,183,.20), transparent 60%),
        radial-gradient(900px 700px at 80% 30%, rgba(125,211,255,.18), transparent 60%),
        radial-gradient(900px 700px at 50% 100%, rgba(255,255,255,.07), transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
    }

    /* estrellitas de fondo */
    .stars, .stars::before, .stars::after{
      position:absolute; inset:0;
      background-repeat:repeat;
      background-size: 280px 280px;
      opacity:.55;
      pointer-events:none;
      animation: drift 60s linear infinite;
      content:"";
    }
    .stars{
      background-image:
        radial-gradient(2px 2px at 20px 40px, rgba(255,255,255,.9), transparent 60%),
        radial-gradient(1px 1px at 90px 120px, rgba(255,255,255,.8), transparent 60%),
        radial-gradient(1px 1px at 150px 60px, rgba(255,255,255,.7), transparent 60%),
        radial-gradient(2px 2px at 220px 200px, rgba(255,255,255,.85), transparent 60%);
    }
    .stars::before{
      background-image:
        radial-gradient(1px 1px at 30px 200px, rgba(255,255,255,.75), transparent 60%),
        radial-gradient(2px 2px at 170px 180px, rgba(255,255,255,.9), transparent 60%),
        radial-gradient(1px 1px at 260px 30px, rgba(255,255,255,.6), transparent 60%),
        radial-gradient(1px 1px at 120px 240px, rgba(255,255,255,.7), transparent 60%);
      opacity:.45;
      animation-duration: 90s;
    }
    .stars::after{
      background-image:
        radial-gradient(2px 2px at 60px 70px, rgba(255,255,255,.95), transparent 60%),
        radial-gradient(1px 1px at 200px 100px, rgba(255,255,255,.7), transparent 60%),
        radial-gradient(1px 1px at 40px 260px, rgba(255,255,255,.6), transparent 60%),
        radial-gradient(2px 2px at 250px 240px, rgba(255,255,255,.85), transparent 60%);
      opacity:.35;
      animation-duration: 120s;
    }
    @keyframes drift{
      from{ transform: translateY(0); }
      to{ transform: translateY(280px); }
    }

    .wrap{
      position:relative;
      height:100%;
      display:grid;
      grid-template-rows:auto 1fr auto;
      gap:12px;
      padding: 18px;
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 14px;
      flex-wrap:wrap;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      padding: 10px 14px;
      border:1px solid var(--border);
      border-radius: 999px;
      background: rgba(0,0,0,.18);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
    }
    .logo{
      width:34px; height:34px;
      border-radius: 999px;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.9), rgba(255,255,255,.15) 60%, rgba(0,0,0,.0) 70%),
        radial-gradient(circle at 70% 70%, rgba(255,111,183,.55), transparent 60%),
        radial-gradient(circle at 25% 75%, rgba(125,211,255,.45), transparent 60%);
      border:1px solid rgba(255,255,255,.22);
    }
    .brand h1{
      margin:0;
      font-size: 14px;
      letter-spacing:.3px;
      line-height:1.1;
    }
    .brand p{
      margin:0;
      font-size: 12px;
      color: var(--muted);
    }

    .controls{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }

    button{
      cursor:pointer;
      color: var(--text);
      border:1px solid var(--border);
      background: rgba(255,255,255,.08);
      padding: 10px 12px;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      backdrop-filter: blur(10px);
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      font-weight: 650;
      letter-spacing:.2px;
      display:flex;
      align-items:center;
      gap:8px;
      user-select:none;
    }
    button:hover{ transform: translateY(-1px); background: rgba(255,255,255,.11); border-color: rgba(255,255,255,.28);}
    button:active{ transform: translateY(0px) scale(.99); }

    .btn-accent{
      border-color: rgba(255,111,183,.45);
      background: linear-gradient(180deg, rgba(255,111,183,.18), rgba(255,255,255,.06));
    }
    .btn-calm{
      border-color: rgba(125,211,255,.45);
      background: linear-gradient(180deg, rgba(125,211,255,.16), rgba(255,255,255,.06));
    }

    .sky{
      position:relative;
      border-radius: var(--radius);
      border:1px solid var(--border);
      background: rgba(0,0,0,.18);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .hint{
      position:absolute;
      left: 14px; top: 12px;
      font-size: 12px;
      color: var(--muted);
      background: rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.14);
      padding: 8px 10px;
      border-radius: 999px;
      backdrop-filter: blur(10px);
      z-index: 3;
    }

    .star{
      position:absolute;
      width: 10px;
      height: 10px;
      border-radius: 999px;
      transform: translate(-50%, -50%);
      background:
        radial-gradient(circle at 35% 35%, rgba(255,255,255,1), rgba(255,255,255,.5) 35%, rgba(255,255,255,0) 70%);
      filter: drop-shadow(0 0 10px rgba(255,255,255,.45));
      opacity:.95;
      animation: twinkle 2.8s ease-in-out infinite;
      cursor:pointer;
    }
    .star::after{
      content:"";
      position:absolute;
      inset:-10px;
      border-radius:999px;
      background: radial-gradient(circle, rgba(255,111,183,.16), transparent 70%);
      opacity:.85;
      transition: opacity .15s ease;
    }
    .star:hover::after{ opacity: 1; }

    @keyframes twinkle{
      0%,100%{ transform: translate(-50%,-50%) scale(1); opacity:.92; }
      50%{ transform: translate(-50%,-50%) scale(1.15); opacity:1; }
    }

    .pulse-ring{
      position:absolute;
      width: 80px; height: 80px;
      border-radius: 999px;
      border: 1px solid rgba(255,111,183,.35);
      transform: translate(-50%,-50%);
      animation: ring 1.1s ease-out forwards;
      pointer-events:none;
      z-index:2;
    }
    @keyframes ring{
      from{ opacity:1; transform: translate(-50%,-50%) scale(.4); }
      to{ opacity:0; transform: translate(-50%,-50%) scale(1.2); }
    }

    /* corazones suaves */
    .floaty{
      position:absolute;
      font-size: 16px;
      opacity: .9;
      transform: translate(-50%,-50%);
      animation: floatUp 1.2s ease-out forwards;
      pointer-events:none;
      filter: drop-shadow(0 8px 18px rgba(0,0,0,.28));
      z-index: 4;
    }
    @keyframes floatUp{
      from{ opacity: 0; transform: translate(-50%,-30%) scale(.9); }
      20%{ opacity: .9; }
      to{ opacity: 0; transform: translate(-50%,-140%) scale(1.15); }
    }

    footer{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      color: var(--muted);
      font-size: 12px;
      padding: 0 6px;
    }
    .small{
      display:flex; gap:8px; align-items:center; flex-wrap:wrap;
    }
    .badge{
      padding: 6px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.16);
      backdrop-filter: blur(10px);
    }

    /* modal */
    .overlay{
      position:absolute;
      inset:0;
      display:none;
      place-items:center;
      background: rgba(0,0,0,.45);
      backdrop-filter: blur(6px);
      z-index: 10;
      padding: 16px;
    }
    .overlay.show{ display:grid; }
    .modal{
      width: min(520px, 96vw);
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.18);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .modal header{
      padding: 14px 14px 10px 14px;
      border-bottom: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.12);
    }
    .modal header h2{
      margin:0;
      font-size: 14px;
      letter-spacing:.3px;
    }
    .modal header p{
      margin:4px 0 0;
      font-size: 12px;
      color: var(--muted);
    }
    .modal .content{
      padding: 14px;
      display:grid;
      gap:10px;
    }

    label{
      font-size: 12px;
      color: var(--muted);
      display:grid;
      gap:6px;
    }
    input, textarea{
      width:100%;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.18);
      color: var(--text);
      padding: 10px 12px;
      outline:none;
    }
    textarea{ min-height: 110px; resize: vertical; }
    input:focus, textarea:focus{
      border-color: rgba(255,111,183,.45);
      box-shadow: 0 0 0 3px rgba(255,111,183,.12);
    }

    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    @media (max-width:520px){
      .row{ grid-template-columns:1fr; }
    }

    .modal .actions{
      display:flex;
      justify-content:flex-end;
      gap:10px;
      padding: 12px 14px 14px;
      border-top: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.10);
    }

    .read-card{
      padding: 14px;
      display:grid;
      gap:10px;
    }
    .read-title{
      margin:0;
      font-size: 18px;
      letter-spacing:.2px;
    }
    .read-date{
      font-size: 12px;
      color: var(--muted);
    }
    .read-text{
      margin:0;
      line-height:1.55;
      color: rgba(255,255,255,.86);
      white-space: pre-wrap;
    }
    .toast{
      position:absolute;
      left: 50%;
      bottom: 16px;
      transform: translateX(-50%);
      padding: 10px 12px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.28);
      backdrop-filter: blur(10px);
      display:none;
      z-index: 12;
      font-size: 12px;
      color: var(--text);
      box-shadow: 0 12px 40px rgba(0,0,0,.35);
    }
    .toast.show{ display:block; animation: toast .9s ease; }
    @keyframes toast{
      from{ opacity:0; transform: translateX(-50%) translateY(10px); }
      to{ opacity:1; transform: translateX(-50%) translateY(0px); }
    }
  </style>
</head>
<body>
  <div class="stars" aria-hidden="true"></div>

  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Nuestra Constelaci√≥n ‚ú®</h1>
          <p>Un cielo de recuerdos ‚Äî para <span id="name">Liz</span></p>
        </div>
      </div>

      <div class="controls">
        <button class="btn-accent" id="addBtn">‚ûï Agregar recuerdo</button>
        <button class="btn-calm" id="surpriseBtn">üé≤ Recuerdo Aleatorio</button>
        <button id="clearBtn" title="Borra todo (con cuidado)">üóëÔ∏è Borrar</button>
      </div>
    </header>

    <main class="sky" id="sky" role="application" aria-label="Cielo interactivo de recuerdos">
      <div class="hint">toca una ‚≠ê para leer el recuerdo</div>
    </main>

    <footer>
      <div class="small">
        <span class="badge" id="countBadge">0 estrellas</span>
        <span class="badge">todo se guarda y ambos lo vemos</span>
      </div>
      <div class="small">
        <span class="badge">Hecho con amor para mi reyna ü©∑</span>
      </div>
    </footer>
  </div>

  <!-- Modal Agregar -->
  <div class="overlay" id="addOverlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="addTitle">
      <header>
        <h2 id="addTitle">Agregar un recuerdo</h2>
        <p>Esto se convertir√° en una estrella en el cielo.</p>
      </header>
      <div class="content">
        <div class="row">
          <label>
            Fecha (opcional)
            <input type="date" id="memDate" />
          </label>
          <label>
            T√≠tulo
            <input type="text" id="memTitle" placeholder="Ej. Nuestro primer cafecito" maxlength="60" />
          </label>
        </div>
        <label>
          Mensaje
          <textarea id="memText" placeholder="Escribe el recuerdo... (o algo que le quieras decir)"></textarea>
        </label>
        <label>
  Imagen (opcional)
  <input type="file" id="memImage" accept="image/*" />
</label>
      </div>
      <div class="actions">
        <button id="cancelAdd">Cancelar</button>
        <button class="btn-accent" id="saveAdd">Guardar ‚≠ê</button>
      </div>
    </div>
  </div>

  <!-- Modal Leer -->
  <div class="overlay" id="readOverlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="readTitle">
      <header>
        <h2 id="readTitle">Recuerdo</h2>
        <p>Una estrellita guardada para ustedes.</p>
      </header>
      <div class="read-card">
        <div class="read-date" id="readDate"></div>
        <h3 class="read-title" id="readHeading"></h3>
         <div id="readImageWrap" style="margin:12px 0;"></div>
        <p class="read-text" id="readText"></p>
      </div>
      <div class="actions">
        <button id="closeRead">Cerrar</button>
        <button class="btn-calm" id="copyRead">Copiar üìã</button>
        <button class="btn-accent" id="deleteOne">Eliminar ‚≠ê</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">Copiado ‚úÖ</div>

<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.94.1/+esm";

  // ====== CONFIG SUPABASE ======
  const SUPABASE_URL = "https://vpyxswvscehjrrbpxmxn.supabase.co";
  const SUPABASE_ANON_KEY = "sb_publishable_EkkNhfqSuhCw3br8F14tEw__tTe-1xf";
  const sb = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  // ====== Config ======
  const girlfriendName = "Liz"; // c√°mbialo si quieres
  document.getElementById("name").textContent = girlfriendName;

  // ====== Elements ======
  const sky = document.getElementById("sky");
  const addOverlay = document.getElementById("addOverlay");
  const readOverlay = document.getElementById("readOverlay");
  const toast = document.getElementById("toast");
  const countBadge = document.getElementById("countBadge");

  const memDate = document.getElementById("memDate");
  const memTitle = document.getElementById("memTitle");
  const memText = document.getElementById("memText");

  const readDate = document.getElementById("readDate");
  const readHeading = document.getElementById("readHeading");
  const readText = document.getElementById("readText");

  let memories = [];
  let selectedId = null;

  // ====== Helpers ======
  function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

  function showToast(msg){
    toast.textContent = msg;
    toast.classList.add("show");
    clearTimeout(showToast._t);
    showToast._t = setTimeout(()=> toast.classList.remove("show"), 1100);
  }

  function openOverlay(el){
    el.classList.add("show");
    el.setAttribute("aria-hidden","false");
  }
  function closeOverlay(el){
    el.classList.remove("show");
    el.setAttribute("aria-hidden","true");
  }

  function updateCount(){
    const n = memories.length;
    countBadge.textContent = `${n} ${n === 1 ? "estrella" : "estrellas"}`;
  }

  function formatDate(iso){
    if(!iso) return "Sin fecha (pero con mucho amor)";
    const d = new Date(iso);
    if(isNaN(d)) return "Sin fecha (pero con mucho amor)";
    return d.toLocaleDateString("es-MX", { year:"numeric", month:"long", day:"numeric" });
  }

  function getXY(mem){
    const rect = sky.getBoundingClientRect();
    const x = clamp((mem.nx ?? 0.5) * rect.width, 20, rect.width - 20);
    const y = clamp((mem.ny ?? 0.5) * rect.height, 50, rect.height - 20);
    return { x, y };
  }

  function randomPosition(){
    const rect = sky.getBoundingClientRect();
    const x = Math.random() * (rect.width - 40) + 20;
    const y = Math.random() * (rect.height - 70) + 50;
    return { x, y, nx: x / rect.width, ny: y / rect.height };
  }

  function spawnRing(x,y){
    const ring = document.createElement("div");
    ring.className = "pulse-ring";
    ring.style.left = x + "px";
    ring.style.top = y + "px";
    sky.appendChild(ring);
    setTimeout(()=> ring.remove(), 1200);
  }

  function spawnHearts(x,y){
    const hearts = ["üíñ","üíó","‚ú®","ü©∑"];
    for(let i=0;i<8;i++){
      const el = document.createElement("div");
      el.className = "floaty";
      el.textContent = hearts[Math.floor(Math.random()*hearts.length)];
      const dx = (Math.random()*120 - 60);
      const dy = (Math.random()*30);
      el.style.left = (x + dx) + "px";
      el.style.top = (y + dy) + "px";
      el.style.animationDuration = (0.9 + Math.random()*0.6) + "s";
      sky.appendChild(el);
      setTimeout(()=> el.remove(), 1400);
    }
  }

  function createStar(mem){
    const { x, y } = getXY(mem);

    const star = document.createElement("div");
    star.className = "star";
    star.dataset.id = mem.id;
    star.style.left = x + "px";
    star.style.top = y + "px";
    star.style.animationDelay = (Math.random()*2.5) + "s";
    star.style.opacity = (0.78 + Math.random()*0.22).toFixed(2);

    const size = 8 + Math.random()*6;
    star.style.width = size + "px";
    star.style.height = size + "px";

    star.addEventListener("click", (e)=>{
      e.stopPropagation();
      openMemory(mem.id, true);
    });

    sky.appendChild(star);
  }

  function renderAll(){
    sky.querySelectorAll(".star").forEach(s => s.remove());
    memories.forEach(createStar);
    updateCount();
  }

  function openMemory(id, withEffects=false){
    const mem = memories.find(m => m.id === id);
    if(!mem) return;
    selectedId = id;

    readDate.textContent = formatDate(mem.mem_date);
    readHeading.textContent = mem.title || "Sin t√≠tulo (pero con sentimiento)";
    const imgWrap = document.getElementById("readImageWrap");
imgWrap.innerHTML = "";

if (mem.image_path) {
  const { data } = sb
    .storage
    .from("memories")
    .getPublicUrl(mem.image_path);

  const url = data.publicUrl;

  imgWrap.innerHTML = `
    <img 
      src="${url}" 
      alt="Recuerdo"
      style="
        width:100%;
        border-radius:14px;
        border:1px solid rgba(255,255,255,.18);
        box-shadow:0 8px 25px rgba(0,0,0,.35);
      "
    />
  `;
}
    readText.textContent = mem.content || "";

    openOverlay(readOverlay);

    if(withEffects){
      const {x,y} = getXY(mem);
      spawnRing(x, y);
      spawnHearts(x, y);
    }
  }

  // ====== Supabase DB ======
  async function fetchMemories(){
    const { data, error } = await sb
      .from("memories")
      .select("*")
      .order("created_at", { ascending: true });

    if(error){
      console.error(error);
      showToast("No pude cargar üòø");
      return;
    }
    memories = data ?? [];
    renderAll();
  }

  function upsertLocal(mem){
    const i = memories.findIndex(m => m.id === mem.id);
    if(i === -1) memories.push(mem);
    else memories[i] = mem;
  }

  function removeLocal(id){
    memories = memories.filter(m => m.id !== id);
    const star = sky.querySelector(`.star[data-id="${id}"]`);
    if(star) star.remove();
    updateCount();
  }

  // Realtime sync (en vivo)
  sb.channel("memories-changes")
    .on("postgres_changes", { event: "*", schema: "public", table: "memories" }, (payload) => {
      if(payload.eventType === "INSERT"){
        const mem = payload.new;
        if(!memories.some(m => m.id === mem.id)){
          upsertLocal(mem);
          createStar(mem);
          updateCount();
        }
      }
      if(payload.eventType === "DELETE"){
        const id = payload.old?.id;
        if(id) {
          removeLocal(id);
          if(selectedId === id) closeOverlay(readOverlay);
        }
      }
      if(payload.eventType === "UPDATE"){
        upsertLocal(payload.new);
        renderAll();
      }
    })
    .subscribe();

  // ====== UI Events ======
  document.getElementById("addBtn").addEventListener("click", ()=>{
    memDate.value = "";
    memTitle.value = "";
    memText.value = "";
    openOverlay(addOverlay);
    setTimeout(()=> memTitle.focus(), 50);
  });

  document.getElementById("cancelAdd").addEventListener("click", ()=> closeOverlay(addOverlay));

  document.getElementById("saveAdd").addEventListener("click", async ()=>{
    const title = memTitle.value.trim();
    const content = memText.value.trim();

    if(!title && !content){
      showToast("Escribe al menos un t√≠tulo o un mensaje üôÇ");
      return;
    }

    const pos = randomPosition();
const memImage = document.getElementById("memImage");
const file = memImage.files?.[0] || null;

let image_path = null;

if (file) {
  // nombre √∫nico
  const ext = file.name.split(".").pop();
  const fileName = `${crypto.randomUUID()}.${ext}`;
  const path = `uploads/${fileName}`;

  const { error: upErr } = await sb
    .storage
    .from("memories")
    .upload(path, file, { contentType: file.type });

  if (upErr) {
    console.error(upErr);
    showToast("No se pudo subir la imagen üòø");
    return;
  }

  image_path = path;
}

// luego tu row incluye image_path
const row = {
  mem_date: memDate.value || null,
  title,
  content,
  nx: pos.nx,
  ny: pos.ny,
  image_path
};


    const { data, error } = await sb
      .from("memories")
      .insert(row)
      .select()
      .single();

    if(error){
      console.error(error);
      showToast("No se pudo guardar üòø");
      return;
    }

    // (Realtime lo a√±adir√° tambi√©n; esto evita sensaci√≥n de ‚Äúdelay‚Äù)
    upsertLocal(data);
    renderAll();

    closeOverlay(addOverlay);
    spawnRing(pos.x, pos.y);
    spawnHearts(pos.x, pos.y);
    showToast("Guardado ‚≠ê");
  });

  document.getElementById("surpriseBtn").addEventListener("click", ()=>{
    if(memories.length === 0){
      showToast("Primero guarda un recuerdito ‚≠ê");
      return;
    }
    const mem = memories[Math.floor(Math.random()*memories.length)];
    openMemory(mem.id, true);
  });

  document.getElementById("clearBtn").addEventListener("click", async ()=>{
    if(memories.length === 0){
      showToast("No hay nada que borrar üôÇ");
      return;
    }
    const ok = confirm("¬øSeguro que quieres borrar TODAS las estrellas? (Esto no se puede deshacer)");
    if(!ok) return;

    const ids = memories.map(m => m.id);
    if(ids.length){
      const { error } = await sb.from("memories").delete().in("id", ids);
      if(error){
        console.error(error);
        showToast("No se pudo borrar üòø");
        return;
      }
    }
    memories = [];
    renderAll();
    showToast("Cielo limpio ‚ú®");
  });

  document.getElementById("closeRead").addEventListener("click", ()=> closeOverlay(readOverlay));

  document.getElementById("copyRead").addEventListener("click", async ()=>{
    const mem = memories.find(m => m.id === selectedId);
    if(!mem) return;
    const payload =
      `üåô Nuestra Constelaci√≥n\n` +
      `‚≠ê ${mem.title || "Recuerdo"}\n` +
      `üìÖ ${formatDate(mem.mem_date)}\n\n` +
      `${mem.content || ""}\n\n` +
      `‚Äî Para ${girlfriendName} üíñ`;

    try{
      await navigator.clipboard.writeText(payload);
      showToast("Copiado ‚úÖ");
    }catch{
      showToast("No se pudo copiar üòø");
    }
  });

  document.getElementById("deleteOne").addEventListener("click", async ()=>{
    const mem = memories.find(m => m.id === selectedId);
    if(!mem) return;
    const ok = confirm("¬øEliminar esta estrella?");
    if(!ok) return;

    const { error } = await sb.from("memories").delete().eq("id", selectedId);
    if(error){
      console.error(error);
      showToast("No se pudo eliminar üòø");
      return;
    }

    closeOverlay(readOverlay);
    removeLocal(selectedId);
    showToast("Eliminada ‚≠ê");
  });

  addOverlay.addEventListener("click", (e)=>{ if(e.target === addOverlay) closeOverlay(addOverlay); });
  readOverlay.addEventListener("click", (e)=>{ if(e.target === readOverlay) closeOverlay(readOverlay); });

  window.addEventListener("keydown", (e)=>{
    if(e.key === "Escape"){
      closeOverlay(addOverlay);
      closeOverlay(readOverlay);
    }
  });

  // En resize solo re-render (nx/ny ya se adaptan)
  window.addEventListener("resize", ()=> renderAll());

  // ====== init ======
  await fetchMemories();
</script>
</body>

</html>







